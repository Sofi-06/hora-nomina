<app-nav-component></app-nav-component>

<div class="create-user-container">
    <h2><i class="fas fa-user-plus"></i>Crear usuario</h2>

    <div *ngIf="errorMessage" class="message error">{{ errorMessage }}</div>
    <div *ngIf="successMessage" class="message success">{{ successMessage }}</div>

    <form (ngSubmit)="onSubmit()" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false">
        <!-- Campos señuelo para desviar autofill del navegador -->
        <input
            type="text"
            name="fake_user_name"
            autocomplete="username"
            tabindex="-1"
            aria-hidden="true"
            style="position: absolute; left: -9999px; width: 1px; height: 1px; opacity: 0;"
        />
        <input
            type="password"
            name="fake_user_password"
            autocomplete="current-password"
            tabindex="-1"
            aria-hidden="true"
            style="position: absolute; left: -9999px; width: 1px; height: 1px; opacity: 0;"
        />

        <div class="form-grid">
            <label>
                Nombre *
                <input
                    type="text"
                    [(ngModel)]="name"
                    name="create_user_full_name"
                    autocomplete="new-password"
                    readonly
                    (focus)="$any($event.target).removeAttribute('readonly')"
                    required
                >
                <small *ngIf="fieldErrors['name']" class="error-text">{{ fieldErrors['name'] }}</small>
            </label>

            <label>
                Email *
                <input
                    type="text"
                    inputmode="email"
                    [(ngModel)]="email"
                    name="create_user_email_address"
                    autocomplete="new-password"
                    readonly
                    (focus)="$any($event.target).removeAttribute('readonly')"
                    required
                >
                <small *ngIf="fieldErrors['email']" class="error-text">{{ fieldErrors['email'] }}</small>
            </label>

            <label>
                Password *
                <input
                    type="password"
                    [(ngModel)]="password"
                    name="create_user_password_value"
                    autocomplete="new-password"
                    readonly
                    (focus)="$any($event.target).removeAttribute('readonly')"
                    required
                >
                <small *ngIf="fieldErrors['password']" class="error-text">{{ fieldErrors['password'] }}</small>
            </label>

            <label>
                Rol *
                <select [(ngModel)]="user_type" name="user_type" required>
                    <option value="Admin">Admin</option>
                    <option value="Docente">Docente</option>
                    <option value="Director">Director</option>
                </select>
                <small *ngIf="fieldErrors['user_type']" class="error-text">{{ fieldErrors['user_type'] }}</small>
            </label>

            <label>
                Tipo ID *
                <select [(ngModel)]="identification_type" name="identification_type" required>
                    <option value="CC">CC</option>
                    <option value="CE">CE</option>
                </select>
                <small *ngIf="fieldErrors['identification_type']" class="error-text">{{ fieldErrors['identification_type'] }}</small>
            </label>

            <label>
                Identificación *
                <input
                    type="text"
                    [(ngModel)]="identification"
                    name="create_user_identification_number"
                    autocomplete="new-password"
                    readonly
                    (focus)="$any($event.target).removeAttribute('readonly')"
                    required
                >
                <small *ngIf="fieldErrors['identification']" class="error-text">{{ fieldErrors['identification'] }}</small>
            </label>

            <div class="field-block">
                <span class="field-label">Género *</span>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" [(ngModel)]="gender" name="gender" value="Femenino" required>
                        <span>Femenino</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" [(ngModel)]="gender" name="gender" value="Masculino" required>
                        <span>Masculino</span>
                    </label>
                </div>
                <small *ngIf="fieldErrors['gender']" class="error-text">{{ fieldErrors['gender'] }}</small>
            </div>

            <label>
                Departamento *
                <select [(ngModel)]="department_id" name="department_id" required>
                    <option [ngValue]="null">Selecciona un departamento</option>
                    <option *ngFor="let dept of departments; trackBy: trackByDeptId" [ngValue]="dept.id">
                        {{ dept.name }}
                    </option>
                </select>
                <small *ngIf="fieldErrors['department_id']" class="error-text">{{ fieldErrors['department_id'] }}</small>
            </label>

            <label>
                Unidades *
                <div class="units-container">
                    <div *ngFor="let unit of units; trackBy: trackByUnitId" class="unit-checkbox">
                        <input
                            type="checkbox"
                            [id]="'unit_' + unit.id"
                            [value]="unit.id"
                            (change)="$event.target.checked ? unit_ids.push(unit.id) : unit_ids.splice(unit_ids.indexOf(unit.id), 1)"
                            [checked]="unit_ids.includes(unit.id)">
                        <label [for]="'unit_' + unit.id">{{ unit.name }}</label>
                    </div>
                </div>
                <small *ngIf="fieldErrors['unit_ids']" class="error-text">{{ fieldErrors['unit_ids'] }}</small>
            </label>
        </div>

        <div class="button-group">
            <button type="submit" [disabled]="isLoading">
                {{ isLoading ? 'Creando...' : 'Crear usuario' }}
            </button>
            <button type="button" (click)="router.navigate(['/usuarios'])">Cancelar</button>
        </div>
    </form>
</div>

<app-footer></app-footer>