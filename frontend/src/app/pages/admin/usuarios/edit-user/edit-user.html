<app-nav-component></app-nav-component>

<div class="create-user-container">
    <h2><i class="fas fa-user-edit"></i>Editar usuario</h2>

    <div *ngIf="isLoadingUser" class="loading">Cargando usuario...</div>

    <form *ngIf="!isLoadingUser" (ngSubmit)="onSubmit()">
        <div *ngIf="errorMessage" class="message error">{{ errorMessage }}</div>
        <div *ngIf="successMessage" class="message success">{{ successMessage }}</div>

        <div class="form-grid">
            <label>
                Nombre *
                <input type="text" [(ngModel)]="name" name="name" required>
            </label>

            <label>
                Email *
                <input type="email" [(ngModel)]="email" name="email" required>
            </label>

            <label>
                Password (dejar vacío para no cambiar)
                <input type="password" [(ngModel)]="password" name="password" (change)="onPasswordChange()">
            </label>

            <label>
                Rol *
                <select [(ngModel)]="user_type" name="user_type" required>
                    <option value="Admin">Admin</option>
                    <option value="Docente">Docente</option>
                    <option value="Director">Director</option>
                </select>
            </label>

            <label>
                Tipo ID *
                <select [(ngModel)]="identification_type" name="identification_type" required>
                    <option value="CC">CC</option>
                    <option value="CE">CE</option>
                </select>
            </label>

            <label>
                Identificación *
                <input type="text" [(ngModel)]="identification" name="identification" required>
            </label>

            <div class="field-block">
                <span class="field-label">Género *</span>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" [(ngModel)]="gender" name="gender" value="Femenino" required>
                        <span>Femenino</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" [(ngModel)]="gender" name="gender" value="Masculino" required>
                        <span>Masculino</span>
                    </label>
                </div>
            </div>

            <label>
                Departamento
                <select [(ngModel)]="department_id" name="department_id">
                    <option [ngValue]="null">Selecciona un departamento</option>
                    <option *ngFor="let dept of departments; trackBy: trackByDeptId" [ngValue]="dept.id">
                        {{ dept.name }}
                    </option>
                </select>
            </label>

            <label>
                Unidades
                <div class="units-container">
                    <div *ngFor="let unit of units; trackBy: trackByUnitId" class="unit-checkbox">
                        <input type="checkbox" [id]="'unit_' + unit.id" [value]="unit.id"
                            (change)="$event.target.checked ? unit_ids.push(unit.id) : unit_ids.splice(unit_ids.indexOf(unit.id), 1)"
                            [checked]="unit_ids.includes(unit.id)">
                        <label [for]="'unit_' + unit.id">{{ unit.name }}</label>
                    </div>
                </div>
            </label>
        </div>

        <div class="button-group">
            <button type="submit" [disabled]="isLoading">
                {{ isLoading ? 'Guardando...' : 'Guardar cambios' }}
            </button>
            <button type="button" (click)="router.navigate(['/usuarios'])">Cancelar</button>
        </div>
    </form>
</div>

<app-footer></app-footer>